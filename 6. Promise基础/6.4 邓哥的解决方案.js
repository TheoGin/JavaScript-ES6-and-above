// å‘æŸä½å¥³ç”Ÿå‘é€ä¸€åˆ™è¡¨ç™½çŸ­ä¿¡
// name: å¥³ç¥çš„å§“å
// onFulffiled: æˆåŠŸåçš„å›è°ƒ
// onRejected: å¤±è´¥åçš„å›è°ƒ
function sendMessage(name) {
  return new Promise((resolve, reject) => {
    // æ¨¡æ‹Ÿ å‘é€è¡¨ç™½çŸ­ä¿¡
    console.log(
      `é‚“å“¥ -> ${name}ï¼šæœ€è¿‘æœ‰è°£è¨€è¯´æˆ‘å–œæ¬¢ä½ ï¼Œæˆ‘è¦æ¾„æ¸…ä¸€ä¸‹ï¼Œé‚£ä¸æ˜¯è°£è¨€ğŸ˜˜`
    );
    console.log(`ç­‰å¾…${name}å›å¤......`);
    // æ¨¡æ‹Ÿ å¥³ç¥å›å¤éœ€è¦ä¸€æ®µæ—¶é—´
    setTimeout(() => {
      // æ¨¡æ‹Ÿ æœ‰10%çš„å‡ ç‡æˆåŠŸ
      if (Math.random() <= 0.1) {
        // æˆåŠŸï¼Œè°ƒç”¨ onFuffiledï¼Œå¹¶ä¼ é€’å¥³ç¥çš„å›å¤
        resolve(`${name} -> é‚“å“¥ï¼šæˆ‘æ˜¯ä¹ï¼Œä½ æ˜¯ä¸‰ï¼Œé™¤äº†ä½ è¿˜æ˜¯ä½ ğŸ˜˜`);
      } else {
        // å¤±è´¥ï¼Œè°ƒç”¨ onRejectedï¼Œå¹¶ä¼ é€’å¥³ç¥çš„å›å¤
        reject(`${name} -> é‚“å“¥ï¼šä½ æ˜¯ä¸ªå¥½äººğŸ˜œ`);
      }
    }, 1000);
  });
}

// é‚“å“¥çš„å¥³ç¥ä¸€å…±æœ‰4ä½ï¼Œåå­—åˆ†åˆ«æ˜¯ï¼šæå»ºå›½ã€ç‹å¯Œè´µã€å‘¨èšè´¢ã€åˆ˜äººå‹‡
// ç¨³å¦¥èµ·è§ï¼Œé‚“å“¥å†³å®šä½¿ç”¨ä¸²è¡Œçš„æ–¹å¼è¿›è¡Œè¡¨ç™½ï¼šå…ˆç»™ç¬¬1ä½å¥³ç¥å‘é€çŸ­ä¿¡ï¼Œç„¶åç­‰å¾…å¥³ç¥çš„å›åº”ï¼Œå¦‚æœæˆåŠŸäº†ï¼Œå°±ç»“æŸï¼Œå¦‚æœå¤±è´¥äº†ï¼Œåˆ™å†ç»™ç¬¬2ä½å¥³ç¥å‘é€çŸ­ä¿¡ï¼Œä¾æ¬¡ç±»æ¨
const p = sendMessage("æå»ºåˆš");

p.then(
  (reply) => {
    console.log("æˆåŠŸ", reply);
  },
  (reply) => {
    console.log("å¤±è´¥", reply);
    sendMessage("ç‹å¯Œè´µ").then(
      (reply) => {
        console.log("æˆåŠŸ", reply);
      },
      (reply) => {
        console.log("å¤±è´¥", reply);
        sendMessage("å‘¨èšè´¢").then(
          (reply) => {
            console.log("æˆåŠŸ", reply);
          },
          (reply) => {
            console.log("å¤±è´¥", reply);
            sendMessage("åˆ˜äººå‹‡").then(
              (reply) => {
                console.log("æˆåŠŸ", reply);
              },
              (reply) => {
                console.log("å¤±è´¥", reply);
                console.log("é‚“å“¥å‘½çŠ¯å¤©ç…å­¤æ˜Ÿï¼Œæ³¨å®šå­¤ç‹¬ç»ˆè€ï¼ï¼");
              }
            );
          }
        );
      }
    );
  }
);
